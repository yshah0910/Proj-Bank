<!DOCTYPE html>
<html>
<head>
    <title>Customer Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 80%; margin: 0 auto; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        form { background-color: #f9f9f9; padding: 15px; border-radius: 5px; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Welcome, {{ customer.name }}</h1>

    {% if error %}
    <div class="error">
        <p>{{ error }}</p>
    </div>
    {% endif %}

    <h2>Your Information</h2>
    <p><strong>SSN:</strong> {{ customer.ssn }}</p>
    <p><strong>Branch:</strong>
        {% if customer.branch %}
            {{ customer.branch.name }}
        {% else %}
            No branch assigned
        {% endif %}
    </p>
    <p><strong>Branch Address:</strong> {{ branch_address }}</p>
    <p><strong>Associated Employee:</strong> {{ associated_employee }}</p>

    <h2>Accounts</h2>
    {% if accounts %}
        {% for account in accounts %}
        <div>
            <h3>Account Number: {{ account.account_no }}</h3>
            <p><strong>Account Type:</strong> {{ account.acc_type }}</p>
            <p><strong>Balance:</strong> ${{ account.balance|floatformat:2 }}</p>
            
            <h4>Transactions</h4>
            {% if account.transactions %}
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Chargeable</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in account.transactions %}
                        <tr>
                            <td>{{ transaction.trans_date }}</td>
                            <td>{{ transaction.trans_type }}</td>
                            <td>${{ transaction.amount|floatformat:2 }}</td>
                            <td>{{ transaction.chargeable }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No transactions available.</p>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p>No accounts found.</p>
    {% endif %}

    <h2>Create New Account</h2>
    <form method="post">
        {% csrf_token %}
        <label for="account_type">Account Type:</label>
        <select name="account_type" id="account_type" required>
            <option value="Savings">Savings</option>
            <option value="Checking">Checking</option>
            <option value="Loan">Loan</option>
            <option value="Money Market">Money Market</option>
        </select>
        <button type="submit" name="create_account">Create Account</button>
    </form>

    <h2>Make a Transaction</h2>
    <form method="post">
        {% csrf_token %}
        <label for="account_no">Account Number:</label>
        <select name="account_no" id="account_no" required>
            {% for account in accounts %}
                <option value="{{ account.account_no }}">{{ account.account_no }} ({{ account.acc_type }})</option>
            {% endfor %}
        </select>
        <label for="trans_type">Transaction Type:</label>
        <select name="trans_type" id="trans_type" required>
            <option value="Deposit">Deposit</option>
            <option value="Withdrawal">Withdrawal</option>
            <option value="Transfer">Transfer</option>
            <option value="Payment">Payment</option>
        </select>
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" step="0.01" min="0.01" required>
        <label for="chargeable">Chargeable:</label>
        <select name="chargeable" id="chargeable" required>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
        </select>
        <button type="submit" name="make_transaction">Make Transaction</button>
    </form>
</body>
</html>